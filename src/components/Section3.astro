---
import { Image } from "astro:assets";
import "../styles/global.css";
import Pattern from "./Pattern.astro";

import Gecko from "../assets/images/gecko.gif";
import Bull from "../assets/images/bull.gif";
---

<section id="duel-wrapper" class="relative h-[200vh] z-50">
  <div
    id="duel-section"
    class="sticky top-0 h-screen w-full bg-[url('/purple-background.png')] overflow-hidden"
  >
    <Pattern />
    <!-- Paneles -->
    <div
      id="duel-left"
      class="absolute top-0 left-0 w-full h-full bg-[url('/blue-background.png')] transform -translate-x-full transition-transform duration-700 ease-in-out z-10 clip-left"
    >
    <Pattern />
    </div>
    <div
      id="duel-right"
      class="absolute top-0 left-0 w-full h-full bg-[url('/red-background.png')] transform translate-x-full transition-transform duration-700 ease-in-out z-20 clip-right"
    >
    <Pattern />
    </div>

    <!-- Texto -->
    <div
      class="relative z-40 flex flex-col items-center justify-center h-full text-white text-center px-4 md:px-10 lg:px-10 pointer-events-none"
    >
      <h2
        class="text-4xl md:text-7xl lg:text-[100px] font-black leading-tight drop-shadow-[4px_4px_0_rgba(0,0,0,1)] -rotate-2 max-w-xs md:max-w-3xl"
      >
        ¿Estás preparado?
      </h2>
      <p
        class="text-base md:text-xl lg:text-xl mt-4 max-w-xs md:max-w-xl leading-snug"
      >
        Prueba los distintos modos: Liga, Batalla Rápida, Amistosa...<br />¡Y
        mucho más!
      </p>
    </div>

    <!-- Contenedor de ambos personajes (ahora después de paneles y texto) -->
    <div
      id="duel-chars"
      class="absolute inset-0 z-30 opacity-0 scale-90 transition-all duration-700 ease-out pointer-events-none"
    >
      <!-- Gecko (mirando hacia la derecha, más grande) -->
      <div class="absolute top-6 left-6 w-52 ml-2 md:w-64 lg:w-3/12">
        <div class="relative">
          <Image
            src={Gecko}
            alt="Gecko"
            class="w-full scale-x-[-1] relative z-10"
          />
          <div
            class="absolute bottom-6 left-1/2 transform -translate-x-1/2 w-[80%] h-3 md:h-4 lg:h-5 bg-black/40 rounded-full blur-md z-0"
          >
          </div>
        </div>
      </div>

      <!-- Bull (más grande) -->
      <div class="absolute bottom-6 right-6 w-52 md:w-64 lg:w-4/12">
        <div class="relative">
          <Image src={Bull} alt="Bull" class="w-full relative z-10" />
          <div
            class="absolute bottom-20 left-1/2 transform -translate-x-1/2 w-[80%] h-3 md:h-4 lg:h-5 bg-black/40 rounded-full blur-md z-0"
          >
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    if (typeof window !== "undefined") {
      const left = document.getElementById("duel-left");
      const right = document.getElementById("duel-right");
      const charGroup = document.getElementById("duel-chars");

      const duelObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              left?.classList.remove("-translate-x-full");
              right?.classList.remove("translate-x-full");
              setTimeout(() => {
                charGroup?.classList.add("opacity-100", "scale-100");
              }, 700);
            } else {
              left?.classList.add("-translate-x-full");
              right?.classList.add("translate-x-full");
              charGroup?.classList.remove("opacity-100", "scale-100");
            }
          });
        },
        { threshold: 0.5 }
      );

      const duelSection = document.getElementById("duel-section");
      if (duelSection) duelObserver.observe(duelSection);
    }
  </script>

  <style>
    .clip-left {
      clip-path: polygon(0 0, 0 100%, 100% 0);
    }

    .clip-right {
      clip-path: polygon(100% 0, 100% 100%, 0 100%);
    }

    .opacity-100 {
      opacity: 1 !important;
    }

    .scale-100 {
      transform: scale(1) !important;
    }
  </style>
</section>
